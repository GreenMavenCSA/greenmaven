<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="shared-styles.html">

<dom-module id="catalog-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }

      paper-fab.green {
        --paper-fab-background: var(--paper-green-500);
        --paper-fab-keyboard-focus-background: var(--paper-green-900);
        float: right;
      }
    </style>

    <div class="card">
      <h1>Search Catalog Items</h1>

      <paper-input id="searchString" label="Enter your search terms (e.g. chicken)" required on-keyup="updateCatalogView"></paper-input>

      <paper-fab icon="add" title="add" class="green"></paper-fab>

      <p><strong>Results</strong></p>

      <table style="border:0">
      <template is="dom-repeat" items="{{categories}}">
          <tr><td width="60%">{{item.name}}</td>
              <td>{{item.category}}</td>
              <td>{{item.retailPrice}}</td>
              <td>{{item.wholesalePrice}}</td>
          </tr>
      </template>
    </table>
    </div>

    <iron-ajax
        id="catalogDatasource"
        url="http://localhost:8081/inventory/rest/catalogService/getCatalogEntries"
        params='{{getParams(searchString)}}'
        handle-as="json"
        on-response="handleResponse">
    </iron-ajax>

  </template>

  <script>
    Polymer({
      is: 'catalog-view',
      properties: {
          categories: {
              type: Array
          },

          searchString: 'all'
          
      },
      ready: function () {
          this.searchString = 'all';
          this.$.catalogDatasource.generateRequest();
      },
      handleResponse: function (data) {
          this.categories = data.detail.response;
      },
      updateCatalogView: function () {
          var currValue = this.$.searchString.value;
          this.searchString = currValue;
          this.$.catalogDatasource.generateRequest();
      },
      getParams: function(pSearchString){
          return {searchString: pSearchString};
      }
    });

    
  </script>
</dom-module>
