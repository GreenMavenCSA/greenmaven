<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input-location/paper-input-location.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link href="https://fonts.googleapis.com/css?family=Dancing+Script" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Sansita" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Annie+Use+Your+Telescope" rel="stylesheet">

<dom-module id="greenmaven-app">
  <template>
    <style is="custom-style">
      :host {
        display: block;
      }

      .bigSearchBox {
        --primary-text-color: #ff5a5f;
        --paper-input-container-input: {font-size: 40px; font-color:#FFFFFF;};
        --paper-input-container-focus-color: --secondary-text-color;
      }

      .emailBox {
        --primary-text-color: #ff5a5f;
        --paper-input-container-input: {font-size: 22px; font-color:#FFFFFF;};
        --paper-input-container-focus-color: --secondary-text-color;
      }

      .quickEmailBox {
        --primary-text-color: #ff5a5f;
        --paper-input-container-focus-color: #FFFFFF;
      }

      .quickCheckbox {
        align-self: center;
        font-family: 'Sansita', sans-serif;
        --paper-checkbox-checked-color: #fdc4c6;
        --paper-checkbox-unchecked-ink-color: #fdc4c6;
        --paper-checkbox-unchecked-color: #fdc4c6;
        --paper-checkbox-label-color: #fdc4c6;
        --paper-checkbox-label-spacing: 0;
        --paper-checkbox-margin: 8px 16px 8px 0;
      }

      .quickIcon {
        --iron-icon-fill-color: #fdc4c6;
        padding-right: 0.5em;
      }

      .littleIcon {
        --iron-icon-height: 30px;
        --iron-icon-width: 30px;
        --iron-icon-fill-color: #ff5a5f;;
      }

      paper-checkbox {
        font-family: 'Sansita', sans-serif;
        --paper-checkbox-checked-color: #ff5a5f;
      }

      paper-checkbox .subtitle {
          font-family: 'Titillium Web', sans-serif;
          display: block;
          font-size: 0.8em;
          margin-top: 2px;
          max-width: 150px;
      }
    </style>

    <paper-dialog id="modalConfirm">
      <p>You're all set!</p>
      <div class="buttons">
        <paper-button dialog-confirm autofocus>Close</paper-button>
      </div>
    </paper-dialog>

    <div id="navbar" style="position: fixed; right: 0; left: 0; z-index: 1030; top: 0">
    <nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
          <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <a class="navbar-brand" href="#" style="font-family: 'Sansita', sans-serif;">GreenMaven</a>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item active">
                <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#about">About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Opportunities</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Support</a>
              </li>
            </ul>
          </div>
        </nav>
        </div>

        <div class="jumbotron jumbotron-fluid jumbotron-top">
        <div class="container" style="margin-top: 50px">
            <h1 class="display-3" style="font-family: 'Sansita', sans-serif; color:#FFFFFF;">GreenMaven</h1>
            <h3 class="display-5" style="font-family: 'Dancing Script', cursive; color:#fdc4c6; padding-left:75px">Your&nbsp;Farms&nbsp;at&nbsp;Your&nbsp;Fingertips.&reg;</h3>
        </div>

        <div class="container-fluid">
          <div class="row" style="margin-top:50px;">
            <div class="col-md-1">&nbsp;</div>
            <div class="col-md-10">
              <div class="card" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
                <div class="card-block">
                  <paper-input-location id="locationBox" class="bigSearchBox" label="Enter your address to find your local marketplace" maps-api-key="AIzaSyBMjBxBM8PUa5T_kezydz2Q1Slev1hn19g" on-place-changed="checkAddress" on-keyup="checkAddress">
                  </paper-input-location>
                </div>
              </div>
            </div>
            <div class="col-md-1">&nbsp;</div>
          </div>
          <iron-collapse id="addressCollapse">
            <div class="row" style="margin-top:5px;">
               <div class="col-md-10 offset-md-1">
                <div class="card" style="background: #292b2c; color: #fefefe; font-family: 'Titillium Web', sans-serif;">
                  <div class="card-block">
                      <iron-collapse id="eligibleCollapse">
                        Based on your zip code, you are eligible to join the {{marketName}} market!<br /><br />
                        Currenty we have {{growersInMarket}} growers registered to serve {{eatersInMarket}} customers.
                        Once we get to 500 customers and 30 growers, we'll start deliveries! Add yourself to the ranks
                        of growers, eaters, and/or drivers by adding your email with the form on the right.
                        <br /><br />
                        To join the marketplace, just enter your email address and tell us if you're interested in growing,
                        eating, or driving.
                        <br /><br />
                      </iron-collapse>
                      <iron-collapse id="ineligibleCollapse">
                        Your zip code falls outside our pilot project area. However, it'll help us out a lot to gauge
                        interest outside of the Charlottesville area. Please fill out the form to the right so we
                        can keep track of interest in GreenMaven in your area!
                        <br /><br />
                      </iron-collapse>
                      <paper-input id="quickEmail" class="quickEmailBox" label="Email address" style="color:#FFFFFF">
                        <iron-icon class="quickIcon" icon="communication:email" prefix></iron-icon>
                      </paper-input>
                      <paper-checkbox class="quickCheckbox" style="color:#FFFFFF"><strong>Grower</strong></paper-checkbox>&nbsp;&nbsp;
                      <paper-checkbox class="quickCheckbox" style="color:#FFFFFF"><strong>Eater</strong></paper-checkbox>&nbsp;&nbsp;
                      <paper-checkbox class="quickCheckbox" style="color:#FFFFFF"><strong>Driver</strong></paper-checkbox><br />
                      <paper-button on-tap="registerUser"><iron-icon icon="done"></iron-icon>Done</paper-button>
                  </div>
                </div>
              </div>
            </div>
          </iron-collapse>
        </div>
      </div>

      <div id="about" class="container">
        
          <div class="row" style="margin-top:25px">
              <div class="col-md-6" style="font-family: 'Titillium Web', sans-serif; font-size:1.4em">
                  <h1><span style="font-family: 'Sansita', sans-serif; color: #ff5a5f;">Beyond Food Hubs</span></h1>
                  <br />
                  The concept is simple: growers tell us what they've got to sell, eaters tell us what they want
                  to buy, and we match up the two according to parameters set by the buyer - price, proximity,
                  favorite farms, growing methods - nothing new here except a design we think you'll be thrilled with.
                  <br /><br /> 
                  As the orders pile up, GreenMaven's algorithms aggregate them into "missions" 
                  that anyone can get paid to execute - be they a farmer, a retiree, or college student with a little 
                  down time.
                  <br /><br />
                  This is a true local food web: the eaters in a community buying directly from their growers, with
                  other members of the community - often the growers and eaters themselves - connecting them via missions.
                  Growers and eaters are not just the stars of the show; they run the show. GreenMaven is little more
                  than math running on computers in the background helping everyone communicate effectively.
                  <br /><br /> 
                  GreenMaven was conceived, designed, and built by farmers. <a href="#" style="color:#ff5a5f">Here's a 
                  little more detail about GreenMaven's conception and mission</a>, if you're interested.
                  <br /><br />
              </div>
              <div class="col-md-6" style="font-family: 'Titillium Web', sans-serif; font-size:1.4em">
                  <h1><span style="font-family: 'Sansita', sans-serif; color: #ff5a5f;">The Benefits!</span></h1>
                  <br />
                  <strong>Growers:</strong> You set your prices. You decide what inventory to expose to the market, 
                  and when. Your market is open 24 hours a day, 7 days a week, without you having to load your trucks 
                  and hit the markets. You spend more time growing food and inviting people to your farm, instead 
                  of sitting at the market hoping it doesn't rain or get too hot. Groceries are delivered in your 
                  packaging and with your marketing, not ours; your customers are yours.
                  <br /><br />
                  <strong>Eaters:</strong> The market's always open. Your groceries can arrive within hours.
                  Lower prices than online grocers and Whole Foods. More choice than the farmer's market, no
                  rain, no oppressive heat, and no sellouts. You don't rely on labels - you know who
                  the farmer is, where they are, and what the farm looks like. And your farmers knows you:
                  that you like your pork chops 2" thick and the tops still on your parsnips.
                  <br /><br />
                  <strong>Drivers:</strong> Execute missions and get paid! You'll literally bring local food to the
                  mainstream, picking up groceries from farms, community gardens, balcony growers and everyone in
                  between, and delivering to homes and relay points in your community.
                  <br /><br />
              </div>
            </div>
          </div>
      </div>

      <div class="container-fluid" style="background-color: #000000">
        <div class="row">
          <div class="col-md-12">
            <p class="text-center" style="padding-top: 20px;font-family: 'Titillium Web', sans-serif; font-size:1.0em; color: #fefefe;">
             &copy;GreenMaven LLC - All Rights Reserved
            </p>
          </div>
        </div>
      </div>

      <iron-ajax
        id="getMarketInfoDatasource"
        params='{{getMarketInfoDatasourceParams(postalCode)}}'
        handle-as="json"
        on-response="handleGetResponse">
      </iron-ajax>

  </template>

  <script>
    Polymer({

      is: 'greenmaven-app',

      properties: {
        postalCode: '',
        marketId: -1,
        marketName: '',
        growersInMarket: 0,
        eatersInMarket: 0
      },

      ready: function () {
          this.$.getMarketInfoDatasource.url = appProperties.userAccountServiceGetGrowersEatersServicePath;
      },
      getMarketInfoDatasourceParams: function(pZip){
          return {zip: pZip.trim()};
      },
      handleGetResponse: function (data) {
          var userTally = data.detail.response;
          this.marketId = userTally.market_id;
          this.marketName = userTally.market_name;
          this.growersInMarket = userTally.num_growers;
          this.eatersInMarket = userTally.num_eaters;

          this.toggleSignupForm();

          if(this.marketId == -1){
            if(!this.$.ineligibleCollapse.opened){
              this.$.ineligibleCollapse.toggle();
            }
            if(this.$.eligibleCollapse.opened){
              this.$.eligibleCollapse.toggle();
            }
          }
          else{
            if(!this.$.eligibleCollapse.opened){
              this.$.eligibleCollapse.toggle();
            }
            if(this.$.ineligibleCollapse.opened){
              this.$.ineligibleCollapse.toggle();
            }
          }
          
      },
      
      checkAddress: function(e) {

        // If the search box isn't a valid address and the signup form is open, close it
        if(!this.$.locationBox.validatePlace() &&
           this.$.addressCollapse.opened){
          this.$.addressCollapse.toggle();
        }

        // If the search box is valid, close the signup form if it's already open. Then
        // call the webservice.
        if(this.$.locationBox.validatePlace()) 
        {
          if(this.$.addressCollapse.opened){
            this.$.addressCollapse.toggle;
          }
          this.postalCode = this.$.locationBox.postalCode;
          this.$.getMarketInfoDatasource.generateRequest();
        }


        // If the search box isn't a valid address and the signup form is closed,
        // don't do anything.
      },
      toggleSignupForm: function(){
        this.$.addressCollapse.toggle();
      },
      registerUser: function(){

        // Save the user info
        this.$.modalConfirm.open();
        this.$.addressCollapse.toggle();
      }
    });



  </script>
</dom-module>
